<!DOCTYPE html>
<html>
  <head>
    <title>Your Cart</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 20px;
      }

      header {
        background-color: #f5f5f5;
        padding: 10px;
        text-align: center;
      }

      h1 {
        margin-bottom: 20px;
      }

      #cart-items {
        display: flex;
        flex-direction: column;
      }

      .cart-item {
        border: 1px solid #ccc;
        padding: 20px;
        display: flex;
        align-items: center;
        margin-bottom: 20px;
      }

      .cart-item img {
        width: 150px;
        height: 150px;
        object-fit: cover;
        margin-right: 20px;
      }

      .cart-item h2 {
        margin-bottom: 10px;
      }

      .cart-item input {
        width: 50px;
        text-align: center;
        margin-bottom: 10px;
      }

      .cart-item p {
        margin: 0;
      }

      .remove-button {
        background-color: #e74c3c;
        color: white;
        border: none;
        padding: 5px 10px;
        cursor: pointer;
      }

      #cart-total {
        margin-top: 20px;
        text-align: right;
      }

      #cart-buttons {
        margin-top: 20px;
        text-align: right;
      }

      #cart-buttons button {
        margin-left: 10px;
      }

      #empty-cart {
        text-align: center;
        margin-top: 20px;
      }

      #empty-cart p {
        margin: 0;
      }
      #cart-buttons button {
        margin-left: 10px;
        background-color: #3498db;
        color: white;
        border: none;
        padding: 8px 15px;
        cursor: pointer;
      }

      #cart-buttons button:hover {
        background-color: #2980b9;
      }
      .timestamp {
        padding: 10px;
      }
    </style>
  </head>
  <body>
    <div class="review-platform">
      <ul>
        {% for review in product.review_set.all %}
        <li>{{ review.review_text }} - {{ review.user.username }}</li>
        {% empty %}
        <li>No reviews available.</li>
        {% endfor %}
      </ul>
    </div>
    <header>
      <h1>Your Cart</h1>
    </header>

    <div id="cart-items">
      <!-- Product list -->
      <div class="cart-item">
        <img
          src="F:\E-COMMERCE-PROJECT\static\images\tshirt-img.png"
          alt="Product 1"
        />
        <div>
          <h2>Product 1</h2>
          <input type="number" value="1" min="1" />
          <p>$10.00</p>
          <p>$10.00</p>
        </div>
        <button class="remove-button">Remove</button>
      </div>
      <div class="cart-item">
        <img
          src="F:\E-COMMERCE-PROJECT\static\images\tshirt-img.png"
          alt="Product 1"
        />
        <div>
          <h2>Product 1</h2>
          <input type="number" value="1" min="1" />
          <p>$100.00</p>
          <p>$100.00</p>
        </div>
        <button class="remove-button">Remove</button>
      </div>
      <div class="cart-item">
        <img
          src="F:\E-COMMERCE-PROJECT\static\images\tshirt-img.png"
          alt="Product 1"
        />
        <div>
          <h2>Product 1</h2>
          <input type="number" value="1" min="1" />
          <p>$50.00</p>
          <p>$50.00</p>
        </div>
        <button class="remove-button">Remove</button>
      </div>

      <div id="cart-total">
        <h3>Total: $0.00</h3>
        <p id="actual-price"></p>
        <p id="discount-price"></p>
        <p id="delivery-fee"></p>
      </div>

      <div id="cart-buttons">
        <button id="update-button">Update</button>
        <button id="continue-shopping-button">Continue Shopping</button>
        <button id="checkout-button">Checkout</button>
      </div>
    </div>

    <div id="empty-cart">
      <p>Your cart is empty. <a href="index.html">Continue shopping</a>.</p>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const updateButton = document.getElementById("update-button");
        const removeButtons = document.getElementsByClassName("remove-button");
        const quantityInputs = document.querySelectorAll(
          'input[type="number"]'
        );

        // Update button click event
        updateButton.addEventListener("click", function () {
          updateTotal();
        });

        // Remove button click events
        for (let i = 0; i < removeButtons.length; i++) {
          const removeButton = removeButtons[i];

          removeButton.addEventListener("click", function () {
            const cartItem = this.parentElement;
            cartItem.remove();

            // Recalculate total and update UI
            updateTotal();

            // Show empty cart message if no items left
            if (document.getElementsByClassName("cart-item").length === 0) {
              document.getElementById("cart-items").style.display = "none";
              document.getElementById("empty-cart").style.display = "block";
            }
          });
        }

        // Number input change event
        quantityInputs.forEach(function (input) {
          input.addEventListener("change", function () {
            updatePrice(this);
          });
        });

        // Function to update the total
        function updateTotal() {
          const cartItems = document.getElementsByClassName("cart-item");
          let subtotal = 0;

          for (let i = 0; i < cartItems.length; i++) {
            const cartItem = cartItems[i];
            const quantity = parseInt(
              cartItem.querySelector('input[type="number"]').value
            );
            const price = parseFloat(
              cartItem.querySelector("p:nth-child(3)").textContent.slice(1)
            );
            const itemTotal = quantity * price;
            cartItem.querySelector("p:nth-child(4)").textContent =
              "$" + itemTotal.toFixed(2);
            subtotal += itemTotal;
          }

          let deliveryFee = 0;
          let discount = 0;
          let total = subtotal;

          if (subtotal < 100) {
            deliveryFee = 5;
            total = subtotal + deliveryFee;
          } else {
            discount = subtotal * 0.03; // Calculate 3% discount
            total = subtotal - discount;
          }

          const cartTotalElement = document.getElementById("cart-total");
          cartTotalElement.querySelector("h3").textContent =
            "Total: $" + total.toFixed(2);

          // Display actual price, discount, and delivery fee
          const actualPriceElement = document.getElementById("actual-price");
          actualPriceElement.textContent =
            "Actual Price: $" + subtotal.toFixed(2);

          const discountPriceElement =
            document.getElementById("discount-price");
          if (discount > 0) {
            discountPriceElement.textContent =
              "Discount: $" + discount.toFixed(2);
          } else {
            discountPriceElement.textContent = "";
          }

          const deliveryFeeElement = document.getElementById("delivery-fee");
          if (deliveryFee > 0) {
            deliveryFeeElement.textContent =
              "Delivery Fee: $" + deliveryFee.toFixed(2);
          } else {
            deliveryFeeElement.textContent = "";
          }
        }

        // Function to update price when quantity changes
        function updatePrice(input) {
          const cartItem = input.parentElement;
          const quantity = parseInt(input.value);
          const price = parseFloat(
            cartItem.querySelector("p:nth-child(3)").textContent.slice(1)
          );
          const itemTotal = quantity * price;
          cartItem.querySelector("p:nth-child(4)").textContent =
            "$" + itemTotal.toFixed(2);

          updateTotal();
        }

        // Initial calculation of total
        updateTotal();
      });
    </script>
  </body>
</html>
